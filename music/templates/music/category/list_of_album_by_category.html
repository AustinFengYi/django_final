<style>
  html {
  height: 100%;
  display: table;
  margin: auto;
}

body {
  height: 100%;
  display: table-cell;
  vertical-align: middle;
  background: yellow;
}


</style>

<script>
  function calculateTotalValue(length) {
  var minutes = Math.floor(length / 60),
    seconds_int = length - minutes * 60,
    seconds_str = seconds_int.toString(),
    seconds = seconds_str.substr(0, 2),
    time = minutes + ':' + seconds

  return time;
}

function calculateCurrentValue(currentTime) {
  var current_hour = parseInt(currentTime / 3600) % 24,
    current_minute = parseInt(currentTime / 60) % 60,
    current_seconds_long = currentTime % 60,
    current_seconds = current_seconds_long.toFixed(),
    current_time = (current_minute < 10 ? "0" + current_minute : current_minute) + ":" + (current_seconds < 10 ? "0" + current_seconds : current_seconds);

  return current_time;
}

function initProgressBar() {
  var player = document.getElementById('player');
  var length = player.duration
  var current_time = player.currentTime;

  // calculate total length of value
  var totalLength = calculateTotalValue(length)
  jQuery(".end-time").html(totalLength);

  // calculate current value time
  var currentTime = calculateCurrentValue(current_time);
  jQuery(".start-time").html(currentTime);

  var progressbar = document.getElementById('seekObj');
  progressbar.value = (player.currentTime / player.duration);
  progressbar.addEventListener("click", seek);

  if (player.currentTime == player.duration) {
    $('#play-btn').removeClass('pause');
  }

  function seek(evt) {
    var percent = evt.offsetX / this.offsetWidth;
    player.currentTime = percent * player.duration;
    progressbar.value = percent / 100;
  }
};

function initPlayers(num) {
  // pass num in if there are multiple audio players e.g 'player' + i

  for (var i = 0; i < num; i++) {
    (function() {

      // Variables
      // ----------------------------------------------------------
      // audio embed object
      var playerContainer = document.getElementById('player-container'),
        player = document.getElementById('player'),
        isPlaying = false,
        playBtn = document.getElementById('play-btn');

      // Controls Listeners
      // ----------------------------------------------------------
      if (playBtn != null) {
        playBtn.addEventListener('click', function() {
          togglePlay()
        });
      }

      // Controls & Sounds Methods
      // ----------------------------------------------------------
      function togglePlay() {
        if (player.paused === false) {
          player.pause();
          isPlaying = false;
          $('#play-btn').removeClass('pause');

        } else {
          player.play();
          $('#play-btn').addClass('pause');
          isPlaying = true;
        }
      }
    }());
  }
}

initPlayers(jQuery('#player-container').length);
</script>

{% extends 'music/base.html' %}
{% block title %}{{ category.name }}{% endblock %}

{% block body %}
  <!--  Song Category --> 
  <section class="secondary-header">
    <ul class="nav nav-pills nav-pills-center">
      <li role="presentation">
        <a href="{% url 'music:index' %}"><span>全部專輯</span></a> 
      </li>
      
      {% for categories in categories %}
      <li role="presentation" class="">
        <a href="{% url 'music:list_of_album_by_category' categories.id %}"><span>{{ categories.name }}專輯</span></a> 
      </li>
      {% endfor %}
    </ul>
  </section>

  <!--  Index Corousel --> 
  <section class="index-corousel">
    <div class="container">
      <div class="col-md-12">
        <div id="myCarousel" class="carousel slide" data-ride="carousel">
        <!-- Indicators -->
        <ol class="carousel-indicators">
          <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
          <li data-target="#myCarousel" data-slide-to="1"></li>
          <li data-target="#myCarousel" data-slide-to="2"></li>
        </ol>

        <!-- Wrapper for slides -->
        <div class="carousel-inner" role="listbox">
          <!--first item-->
          <div class="item active">
            <div class="container">

              <div class="slide-wrapper">
                <div class="col-md-6">
                  <div class="slide-image">
                    <div class="thumbnail">
                      <!--img src="image/slide/slide-1.jpg" alt="slide-1"-->
                      {% load staticfiles %}
                      <img src="{% static 'music/images/slider/slide-1.jpg' %}"/> 
                    </div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="slide-content">
                    <h3>Lorem ipsum dolor sit.</h3>
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Tempore dolor, cupiditate consectetur veritatis incidunt ratione!</p>
                    <!--<a href="about-content.html" class="btn btn-primary">繼續閱讀</a>-->
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!--second item-->
          <div class="item">
            <div class="container">

              <div class="slide-wrapper">
                <div class="col-md-6">
                  <div class="slide-image">
                    <div class="thumbnail">
                      <!--img src="image/slide/slide-2.jpg" alt="slide-1"-->
                      {% load staticfiles %}
                      <img src="{% static 'music/images/slider/slide-2.jpg' %}"/>
                    </div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="slide-content">
                    <h3>Lorem ipsum dolor sit.</h3>
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Iste assumenda corporis, sequi.</p>
                    <!--<a href="about-content.html" class="btn btn-primary">繼續閱讀</a>--> </div>
                </div>
              </div>
            </div>
          </div>

          <!--third item-->
          <div class="item">
            <div class="container">
              <div class="slide-wrapper">
                <div class="col-md-6">
                  <div class="slide-image">
                    <div class="thumbnail">
                      <!--img src="image/slide/slide-3.jpg" alt="slide-1"-->
                      {% load staticfiles %}
                      <img src="{% static 'music/images/slider/slide-3.jpg' %}"/>
                    </div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="slide-content">
                    <h3>Research Highlight</h3>
                    <p>In this paper, we demonstrate a simple approach of self-assembled process to form a very smooth and compacted TiO2 underlayer film from ultrafine titanium oxide (TiO2) nanocrystals with dimension of 4 nm for improving the electrical properties and device performances of dye-sensitized solar cells (DSSCs).</p>
                    <!--<a href="about-content.html" class="btn btn-primary">繼續閱讀</a>-->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Left and right controls -->
        <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
          <span class="glyphicon glyphicon-chevron-left"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
          <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>

          <span class="sr-only">Next</span>
        </a>
      </div>
    </div>
  </section>

  <section class="album-recommend">
    <div class="container">
      <div class="col-md-12">
        <h3>影音推薦</h3>
        <div class="row-fluid row">
          <div class="col-md-4" >
            <img src="https://img.youtube.com/vi/rD-T5pzH9b0/maxresdefault.jpg" alt="">
            <h4>盧廣仲 Crowd Lu【愛情怎麼了嗎 Self-complacent】Official Music Video</h4>
          </div>

          <div class="col-md-4" >
            <img src="https://img.youtube.com/vi/Dab4EENTW5I/maxresdefault.jpg" alt="">
            <h4>Stray Kids "MIROH" M/V</h4>
          </div>

          <div class="col-md-4" >
            <img src="https://img.youtube.com/vi/nn48zwymeNA/maxresdefault.jpg" alt="">
            <h4>Why Don't We - Cold in LA 寒冷洛杉磯 (華納official HD 高畫質官方中字版)</h4>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="album-rank">
    <div class="container">
      <div class="col-md-12">
        <h3>排行榜</h3>
        <div class="row-fluid row">
          <!--table1-->
          <div class="col-md-4">
            <table class="table-rank table table-striped table-bordered">
              <tr>
                <th>熱門單曲</th>
              </tr>

              <tr> 
              {% for albums in all_albums %}  
                {% if albums.category_id = 1 %}                 
                  <td>
                    <div style="float: left;">Top</div>
                    <div style="float: left;">{{ albums.album_title }}<br>{{ albums.singer.singer_name }}</div>
                  </td>
                {% endif %}  
              {% endfor %}      
              <tr>
            </table>
          </div>

          <!--table2-->
          <div class="col-md-4">
            <table class="table-rank table table-striped table-bordered">
              <tr>
                <th>熱門專輯</th>
              </tr>

              <tr> 
              {% for album in albums %}  
                <td>
                  <div style="float: left;">{{ forloop.counter }}</div>
                  <div style="float: left;">{{ album.album_title }}<br>{{ album.singer.singer_name }}</div>
                  
                  
                  <!-- Button trigger modal -->
                  <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#{{album.id}}">
                    Launch demo modal
                  </button>
                  
                  <!-- Modal -->
                  <div class="modal fade" id="{{album.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          {% for song in album.song_set.all %}
                            <audio controls>
                              <source src="{{ song.audio_file.url }}" type="audio/mpeg">
                            </audio>
                            {{ song.song_name }}
                          {% endfor %}
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  
                </td> 
              {% endfor %}      
              <tr>

            </table>
          </div>

          <!--table3-->
          <div class="col-md-4">
            <table class="table-rank table table-striped table-bordered">
              <tr>
                <th>懷舊專輯/th>
              </tr>

              <tr> 
              {% for albums in albums %}  
                <td>
                  <div style="float: left;">{{ forloop.counter }}</div>
                  <div style="float: left;">{{ albums.album_title }}<br>{{ albums.singer.singer_name }}</div>
                </td> 
              {% endfor %}      
              <tr>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="popular-singer">
    <div class="container">
      <div class="col-md-12">
        <h3>熱門歌手</h3>
        <div class="row-fluid row">
          <div class="singer-content">
            {% for singers in singers|slice:":6" %}
              <div class="col-md-2"> 
                <img src="{{singers.singer_avatar.url}}">
                <p class="text-center">{{singers.singer_name}}</p>
              </div> 
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </section>  


  <div class="audio-player">
    <div id="play-btn"></div>
    <div class="audio-wrapper" id="player-container" href="javascript:;">
      <audio id="player" ontimeupdate="initProgressBar()">
        <source src="http://www.lukeduncan.me/oslo.mp3" type="audio/mp3">
      </audio>
    </div>
    <div class="player-controls scrubber">
      <p>Oslo <small>by</small> Holy Esque</p>
      <span id="seekObjContainer">
        <progress id="seekObj" value="0" max="1"></progress>
      </span>
      <br>
      <small style="float: left; position: relative; left: 15px;" class="start-time"></small>
      <small style="float: right; position: relative; right: 20px;" class="end-time"></small>

    </div>
    <div class="album-image" style="background-image: url('https://artwork-cdn.7static.com/static/img/sleeveart/00/051/614/0005161476_350.jpg')"></div>
  </div>

{% endblock %}

